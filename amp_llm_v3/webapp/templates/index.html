<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMP LLM - Clinical Trial Research</title>
    
    <!-- Base styles (completely rewritten for proper scrolling) -->
    <link rel="stylesheet" href="/static/style-base.css">
    
    <!-- Theme stylesheet (dynamically loaded) -->
    <link rel="stylesheet" id="theme-stylesheet" href="/static/theme-green.css">
</head>
<body>
    <div class="container">
        <!-- Auth Section -->
        <div id="auth-section" class="auth-section">
            <div class="auth-box">
                <h1>üî¨ AMP LLM</h1>
                <p>Clinical Trial Research Assistant</p>
                <input type="password" id="api-key-input" placeholder="Enter API Key" />
                <button onclick="app.handleAuth()">Login</button>
                <p class="help-text">Enter your API key to access the system</p>
            </div>
        </div>

        <!-- Main App (hidden until authenticated) -->
        <div id="main-app" class="hidden">
            <!-- Header (fixed) -->
            <header id="app-header" class="hidden">
                <div class="header-left">
                    <button class="back-button" onclick="app.showMenu()">‚Üê Back</button>
                    <div>
                        <h1 id="mode-title">AMP LLM</h1>
                        <p id="mode-subtitle"></p>
                    </div>
                </div>
                <div class="header-right">
                    <!-- Theme Switcher -->
                    <div class="theme-switcher">
                        <button class="theme-button" onclick="app.toggleThemeDropdown()">
                            <span>üé®</span>
                            <span id="current-theme-name">Green</span>
                        </button>
                        <div class="theme-dropdown hidden" id="theme-dropdown">
                            <div class="theme-option" onclick="app.setTheme('green')">
                                <div class="theme-indicator" style="background: linear-gradient(135deg, #1BEB49 0%, #0E1F81 100%);"></div>
                                <span>Green Primary</span>
                            </div>
                            <div class="theme-option" onclick="app.setTheme('blue')">
                                <div class="theme-indicator" style="background: linear-gradient(135deg, #0E1F81 0%, #1BEB49 100%);"></div>
                                <span>Blue Primary</span>
                            </div>
                            <div class="theme-option" onclick="app.setTheme('balanced')">
                                <div class="theme-indicator" style="background: linear-gradient(135deg, #0E1F81 0%, #1BEB49 50%, #FFA400 100%);"></div>
                                <span>Tri-Color</span>
                            </div>
                            <div class="theme-option" onclick="app.setTheme('professional')">
                                <div class="theme-indicator" style="background: linear-gradient(135deg, #2C3E50 0%, #16A085 50%, #E67E22 100%);"></div>
                                <span>Professional</span>
                            </div>
                        </div>
                    </div>
                    <button class="logout-button" onclick="app.handleLogout()">Logout</button>
                </div>
            </header>

            <!-- Menu Section (scrollable) -->
            <div id="menu-view" class="menu-section">
                <h2 class="menu-title">Select a Mode</h2>
                <div class="menu-grid">
                    <div class="menu-item" onclick="app.showMode('chat')">
                        <div class="menu-item-icon">üí¨</div>
                        <div class="menu-item-title">Chat with LLM</div>
                        <div class="menu-item-desc">Interactive conversation with AI models</div>
                    </div>
                    <div class="menu-item" onclick="app.showMode('nct')">
                        <div class="menu-item-icon">üîç</div>
                        <div class="menu-item-title">NCT Lookup</div>
                        <div class="menu-item-desc">Search clinical trials by NCT number</div>
                    </div>
                    <div class="menu-item" onclick="app.showMode('research')">
                        <div class="menu-item-icon">üìö</div>
                        <div class="menu-item-title">Research Assistant</div>
                        <div class="menu-item-desc">RAG-powered trial analysis</div>
                    </div>
                    <div class="menu-item" onclick="app.showMode('files')">
                        <div class="menu-item-icon">üìÅ</div>
                        <div class="menu-item-title">File Manager</div>
                        <div class="menu-item-desc">Browse, upload, and load trial data</div>
                    </div>
                </div>
            </div>

            <!-- Chat Mode: Info bar (fixed) + Scrollable content + Input (fixed) -->
            <div id="chat-mode" class="mode-container">
                <!-- Info bar will be dynamically inserted here by JS -->
                <div class="chat-container" id="chat-container"></div>
                <div class="input-area">
                    <textarea id="chat-input" placeholder="Type a message..." rows="3"></textarea>
                    <button onclick="app.sendMessage('chat')">Send</button>
                </div>
            </div>

            <!-- Research Mode: Info bar (fixed) + Scrollable content + Input (fixed) -->
            <div id="research-mode" class="mode-container">
                <!-- Info bar will be dynamically inserted here by JS -->
                <div class="research-container" id="research-container"></div>
                <div class="input-area">
                    <textarea id="research-input" placeholder="Ask about clinical trials..." rows="3"></textarea>
                    <button onclick="app.sendMessage('research')">Research</button>
                </div>
            </div>

            <!-- NCT Lookup Mode: Input area (fixed with scroll) + Results (scrollable) -->
            <div id="nct-mode" class="mode-container">
                <div class="nct-input-area">
                    <div class="nct-input-group">
                        <label>Enter NCT Numbers (comma-separated):</label>
                        <textarea id="nct-input" placeholder="NCT03936426, NCT12345678"></textarea>
                    </div>
                    <div class="nct-input-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="use-extended-apis" />
                            <span>Use Extended APIs (PMC, EudraCT, WHO ICTRP, Semantic Scholar, DuckDuckGo, Google)</span>
                        </label>
                    </div>
                    <div class="nct-buttons">
                        <button class="nct-submit" onclick="app.handleNCTLookup()">
                            <span>üîç</span>
                            <span>Fetch Trials</span>
                        </button>
                        <button class="nct-save hidden" id="nct-save-btn" onclick="app.saveNCTResults()">
                            <span>üíæ</span>
                            <span>Save Results</span>
                        </button>
                    </div>
                    <div class="progress-text hidden" id="nct-progress"></div>
                </div>
                <div class="nct-results" id="nct-results"></div>
            </div>

            <!-- File Manager Mode: Controls (fixed) + Files grid (scrollable) -->
            <div id="files-mode" class="mode-container">
                <div class="file-controls">
                    <button class="file-upload-btn" onclick="document.getElementById('file-upload-input').click()">
                        <span>üì§</span>
                        <span>Upload File</span>
                    </button>
                    <button class="file-refresh-btn" onclick="app.loadFiles()">
                        <span>üîÑ</span>
                        <span>Refresh</span>
                    </button>
                    <input type="file" id="file-upload-input" accept=".json,.txt" style="display: none;" onchange="app.handleFileUpload(event)" />
                </div>
                <div class="files-container" id="files-container">
                    <div class="loading">Loading files...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>