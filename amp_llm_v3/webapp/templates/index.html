<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMP LLM - Clinical Trial Research Assistant</title>
    
    <!-- Base styles -->
    <link rel="stylesheet" href="/static/style-base.css">
    
    <!-- Theme stylesheet (dynamically loaded) -->
    <link rel="stylesheet" id="theme-stylesheet" href="/static/theme-green.css">
</head>
<body>
    <div class="container">
        <!-- Auth Section -->
        <div id="auth-section" class="auth-section">
            <div class="auth-box">
                <h1>üî¨ AMP LLM</h1>
                <p>Clinical Trial Research Assistant</p>
                <input type="password" id="api-key-input" placeholder="Enter API Key" />
                <button onclick="app.handleAuth()">Login</button>
                <p class="help-text">Enter your API key to access the system</p>
            </div>
        </div>

        <!-- Main App (hidden until authenticated) -->
        <div id="main-app" class="hidden">
            <!-- ============================================================
                 LANDING PAGE HEADER BANNER
                 Fixed banner with logo, title, theme picker, and LOGOUT
                 ============================================================ -->
            <div id="landing-header" class="landing-header">
                <div class="landing-header-left">
                    <div class="logo-container">
                        <img src="/static/amp_logo.png" alt="AMP Logo" class="amp-logo" />
                    </div>
                </div>
                
                <div class="landing-header-center">
                    <h1 class="landing-title">LLM Research Assistant</h1>
                    <p class="landing-version">v0.3</p>
                </div>
                
                <div class="landing-header-right">
                    <div class="theme-switcher">
                        <button class="theme-button" onclick="app.toggleThemeDropdown()">
                            <span>üé®</span>
                            <span id="current-theme-name">Loading...</span>
                        </button>
                        <div class="theme-dropdown hidden" id="theme-dropdown">
                            <div class="loading" style="padding: 20px; text-align: center; color: #999;">
                                Loading themes...
                            </div>
                        </div>
                    </div>
                    <button class="logout-button" onclick="app.handleLogout()">Logout</button>
                </div>
            </div>

            <!-- ============================================================
                 MODE PAGE HEADER (shown when in a specific mode)
                 ============================================================ -->
            <header id="app-header" class="hidden">
                <div class="header-left">
                    <button class="back-button" onclick="app.showMenu()">‚Üê Back</button>
                    <div>
                        <h1 id="mode-title">AMP LLM</h1>
                        <p id="mode-subtitle"></p>
                    </div>
                </div>
                <div class="header-right">
                    <div class="theme-switcher">
                        <button class="theme-button" onclick="app.toggleThemeDropdown()">
                            <span>üé®</span>
                            <span id="current-theme-name-2">Loading...</span>
                        </button>
                        <div class="theme-dropdown hidden" id="theme-dropdown-2">
                            <div class="loading" style="padding: 20px; text-align: center; color: #999;">
                                Loading themes...
                            </div>
                        </div>
                    </div>
                    <button class="logout-button" onclick="app.handleLogout()">Logout</button>
                </div>
            </header>

            <!-- Menu Section (scrollable) -->
            <div id="menu-view" class="menu-section">
                <h2 class="menu-title">Select a Mode</h2>
                <div class="menu-grid">
                    <div class="menu-item" onclick="app.showMode('chat')">
                        <div class="menu-item-icon">üí¨</div>
                        <div class="menu-item-title">Chat with LLM</div>
                        <div class="menu-item-desc">Interactive conversation with AI models</div>
                    </div>
                    <div class="menu-item" onclick="app.showMode('nct')">
                        <div class="menu-item-icon">üîç</div>
                        <div class="menu-item-title">NCT Lookup</div>
                        <div class="menu-item-desc">Search clinical trials by NCT number</div>
                    </div>
                    <div class="menu-item" onclick="app.showMode('research')">
                        <div class="menu-item-icon">üìö</div>
                        <div class="menu-item-title">Research Assistant</div>
                        <div class="menu-item-desc">RAG-powered trial analysis</div>
                    </div>
                    <div class="menu-item" onclick="app.showMode('files')">
                        <div class="menu-item-icon">üìÅ</div>
                        <div class="menu-item-title">File Manager</div>
                        <div class="menu-item-desc">Browse, upload, and load trial data</div>
                    </div>
                </div>
            </div>

            <!-- Chat Mode -->
            <div id="chat-mode" class="mode-container">
                <div class="chat-container" id="chat-container"></div>
                <div class="input-area">
                    <textarea id="chat-input" placeholder="Type a message..." rows="3"></textarea>
                    <button onclick="app.sendMessage('chat')">Send</button>
                </div>
            </div>

            <!-- Research Mode -->
            <div id="research-mode" class="mode-container">
                <div class="research-container" id="research-container"></div>
                <div class="input-area">
                    <textarea id="research-input" placeholder="Ask about clinical trials..." rows="3"></textarea>
                    <button onclick="app.sendMessage('research')">Research</button>
                </div>
            </div>
            
            <!-- NCT Lookup Mode - UPDATED with Dynamic API Selection -->
            <div id="nct-mode" class="mode-container">
                <div class="nct-input-area">
                    <div class="nct-input-group">
                        <label>Enter NCT Numbers (comma-separated):</label>
                        <textarea id="nct-input" placeholder="NCT03936426, NCT12345678"></textarea>
                    </div>
                    
                    <!-- Dynamic API Selection -->
                    <div class="nct-api-selection">
                        <div class="api-section">
                            <div class="api-section-header">
                                <h4>üìö Core Databases</h4>
                                <p class="api-section-desc">Essential trial data sources (always included)</p>
                            </div>
                            <div id="core-apis-container" class="api-checkboxes">
                                <!-- Core API checkboxes will be dynamically inserted here -->
                                <div class="loading-apis">
                                    <span class="spinner-small"></span>
                                    <span>Loading available APIs...</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="api-section">
                            <div class="api-section-header">
                                <h4>üåê Extended Databases</h4>
                                <p class="api-section-desc">Additional sources for comprehensive coverage</p>
                            </div>
                            <div id="extended-apis-container" class="api-checkboxes">
                                <!-- Extended API checkboxes will be dynamically inserted here -->
                                <div class="loading-apis">
                                    <span class="spinner-small"></span>
                                    <span>Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="nct-buttons">
                        <button class="nct-submit" onclick="app.handleNCTLookup()">
                            <span>üîç</span>
                            <span>Fetch Trials</span>
                        </button>
                        <button class="nct-save hidden" id="nct-download-btn" onclick="app.downloadNCTResults()">
                            <span>üì•</span>
                            <span>Download</span>
                        </button>
                        <button class="nct-save hidden" id="nct-save-btn" onclick="app.saveNCTResults()">
                            <span>üíæ</span>
                            <span>Save to Server</span>
                        </button>
                    </div>
                    <div class="progress-text hidden" id="nct-progress"></div>
                </div>
                <div class="nct-results" id="nct-results"></div>
            </div>

            <!-- File Manager Mode -->
            <div id="files-mode" class="mode-container">
                <div class="file-controls">
                    <button class="file-upload-btn" onclick="document.getElementById('file-upload-input').click()">
                        <span>üì§</span>
                        <span>Upload File</span>
                    </button>
                    <button class="file-refresh-btn" onclick="app.loadFiles()">
                        <span>üîÑ</span>
                        <span>Refresh</span>
                    </button>
                    <input type="file" id="file-upload-input" accept=".json,.txt" style="display: none;" onchange="app.handleFileUpload(event)" />
                </div>
                <div class="files-container" id="files-container">
                    <div class="loading">Loading files...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>